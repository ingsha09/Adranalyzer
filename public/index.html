<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdSense Readiness Analyzer</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #4285F4;
            --secondary-color: #333;
            --text-color: #e0e0e0;
            --muted-text-color: #888;
            --pass-color: #34A853;
            --fail-color: #EA4335;
            --warn-color: #FBBC05;
            --border-color: #3a3a3a;
            --font-family: 'system-ui', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --border-radius: 12px;
            --transition-speed: 0.4s;
        }

        /* Universal reset and body styling */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden; /* Prevent horizontal scroll from potential small overflow */
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Responsive padding: min 1rem, preferred 5vw, max 3rem */
            padding: clamp(1.5rem, 5vw, 3rem) clamp(1rem, 3vw, 2rem); 
            min-height: 100vh;
        }

        .container { 
            width: 100%; 
            max-width: 900px; /* Increased max-width slightly for larger screens */
            padding: 0; /* Ensure container itself doesn't add padding causing margin issues */
        }

        header { text-align: center; margin-bottom: 2.5rem; }
        header h1 { 
            /* Responsive font size for H1 */
            font-size: clamp(1.8rem, 5vw, 2.8rem); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #fff; 
            line-height: 1.2;
            /* Removed gap from h1 and added margin-right to icon */
        }
        header h1 i {
            margin-right: 0.5rem; /* Space between icon and text */
            font-size: clamp(1.8rem, 5vw, 2.8rem); /* Ensure icon scales with h1 text */
        }
        header p { 
            color: var(--muted-text-color); 
            margin-top: 0.75rem; 
            max-width: 600px; 
            margin-left: auto; 
            margin-right: auto; 
            line-height: 1.6; 
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }

        #analysis-form { 
            display: flex; 
            gap: 1rem; 
            margin-bottom: 2.5rem; 
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
        }
        #url-input { 
            flex-grow: 1; 
            padding: 1rem 1.2rem; 
            font-size: 1.1rem; 
            background-color: var(--surface-color); 
            border: 1px solid var(--border-color); 
            border-radius: var(--border-radius); 
            color: var(--text-color); 
            transition: all var(--transition-speed); 
            min-width: 200px; /* Ensures input doesn't get too small */
        }
        #url-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.2); }
        #analyze-btn { 
            padding: 1rem 1.5rem; 
            font-size: 1.1rem; 
            font-weight: 600; 
            background-color: var(--primary-color); 
            color: #fff; 
            border: none; 
            border-radius: var(--border-radius); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            transition: all var(--transition-speed); 
            justify-content: center; /* Center content in button */
        }
        #analyze-btn:hover { opacity: 0.9; transform: translateY(-2px); }
        #analyze-btn:disabled { background-color: var(--secondary-color); opacity: 0.7; cursor: not-allowed; transform: none; }
        .loader { width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .error-message {
            display: none;
            padding: 1rem;
            background-color: rgba(234, 67, 53, 0.1);
            border: 1px solid var(--fail-color);
            border-radius: var(--border-radius);
            color: var(--text-color);
            margin-bottom: 2rem;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        #results-container { 
            display: none; 
            /* Flexible grid: auto-fit creates as many 300px columns as possible, then they expand */
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            align-items: flex-start; 
        }
        .result-card { 
            background-color: var(--surface-color); 
            border-radius: var(--border-radius); 
            padding: 1.5rem; 
            border: 1px solid var(--border-color); 
        }

        #score-card { 
            text-align: center; 
            position: sticky; 
            top: 2rem; /* Stick to top on larger screens */
        }
        .score-circle { position: relative; width: 180px; height: 180px; margin: 1rem auto; }
        .score-circle svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .score-circle circle { fill: none; stroke-width: 12; }
        .score-bg { stroke: var(--secondary-color); }
        .score-fg { stroke: var(--primary-color); stroke-linecap: round; transition: stroke-dashoffset 1.5s ease-out; }
        .score-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5rem; font-weight: bold; color: #fff; }
        #score-summary { font-size: 1rem; line-height: 1.5; color: var(--muted-text-color); }
        #score-title { font-size: 1.4rem; font-weight: 600; margin-bottom: 0.5rem; }

        .checklist-category { margin-bottom: 2rem; }
        .checklist-category h3 { 
            font-size: 1.2rem; 
            margin-bottom: 1rem; 
            padding-bottom: 0.5rem; 
            border-bottom: 1px solid var(--border-color); 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
        }
        .check-item { 
            display: flex; 
            align-items: flex-start; 
            gap: 1rem; 
            padding: 0.75rem 0; 
            border-bottom: 1px solid var(--border-color); 
        }
        .check-item:last-child { border-bottom: none; }
        .check-item .icon { font-size: 1.5rem; flex-shrink: 0; margin-top: 2px;}
        .check-item.pass .icon { color: var(--pass-color); }
        .check-item.fail .icon { color: var(--fail-color); }
        .check-item.warn .icon { color: var(--warn-color); }
        .check-item.manual .icon { color: var(--primary-color); }
        .check-item-details strong { display: block; font-size: 1rem; margin-bottom: 0.25rem; color: var(--text-color); }
        .check-item-details p { font-size: 0.9rem; color: var(--muted-text-color); line-height: 1.5; }

        .final-disclaimer { 
            padding: 1rem; 
            background-color: rgba(234, 67, 53, 0.1); 
            border-left: 4px solid var(--fail-color); 
            margin-top: 1rem; 
            border-radius: 4px; 
            font-size: 0.9rem;
        }
        .final-disclaimer strong { color: var(--text-color); }

        /* Recommendations Styling */
        #recommendations-card {
            display: none;
        }

        #recommendations-list {
            list-style: none;
            padding: 0;
        }

        #recommendations-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        #recommendations-list li:last-child {
            border-bottom: none;
        }

        #recommendations-list li::before {
            content: "\\f0a9"; /* Font Awesome right arrow */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
        .info-note {
            font-size: 0.9rem;
            color: var(--muted-text-color);
            margin-top: 1rem;
        }

        /* Media Queries for specific breakpoints */
        @media (max-width: 768px) { 
            /* On screens smaller than 768px, force a single column layout */
            #results-container { 
                grid-template-columns: 1fr; 
                gap: 1.5rem; /* Maintain gap */
            } 
            #score-card { 
                position: static; /* Remove sticky positioning on smaller screens */
            } 
            #analysis-form {
                flex-direction: column; /* Stack input and button vertically */
            }
            #url-input, #analyze-btn {
                width: 100%; /* Make them full width */
            }
        }

        @media (max-width: 600px) { 
            body { 
                /* Even more compact padding on very small screens */
                padding: 1.5rem 0.8rem; 
            } 
            header h1 { 
                font-size: clamp(1.6rem, 7vw, 2rem); /* Smaller font on very small screens */
            } 
            header h1 i {
                font-size: clamp(1.6rem, 7vw, 2rem); /* Ensure icon scales with smaller h1 text */
            }
            header p {
                font-size: clamp(0.85rem, 2.5vw, 1rem); /* Smaller paragraph text */
            }
            #analysis-form { margin-bottom: 2rem; }
            .result-card { padding: 1.2rem; } /* Slightly less padding inside cards */
            .check-item-details strong { font-size: 0.95rem; }
            .check-item-details p { font-size: 0.85rem; }
            .final-disclaimer { font-size: 0.85rem; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <div class="container">
        <header>
            <div class="logo-container" style="text-align: center; margin-bottom: 1rem;">
                <img src="logo.png" alt="AdRanalyzer Logo" style="max-width: 400px; height: auto;">
            </div>
            <h1>AdSense Readiness Analyzer</h1>
            <p>Get a technical analysis of your site against common AdSense requirements. This tool checks for technical signals, not content quality.</p>
        </header>

        <form id="analysis-form">
            <input type="text" id="url-input" placeholder="https://example.com" required>
            <button type="submit" id="analyze-btn">
                <i class='bx bx-search-alt'></i>
                <span>Analyze</span>
            </button>
        </form>

        <div id="error-message" class="error-message"></div>

        <div id="results-container">
            <div class="result-card" id="score-card">
                <h2 id="score-title">Technical Readiness Score</h2>
                <div class="score-circle">
                    <svg><circle class="score-bg" cx="90" cy="90" r="84"></circle><circle class="score-fg" id="score-progress" cx="90" cy="90" r="84"></circle></svg>
                    <div class="score-text" id="score-value">0%</div>
                </div>
                <p id="score-summary">This score reflects technical and structural best practices. A high score does NOT guarantee approval.</p>
            </div>
            <div class="result-card" id="checklist-card">
                <!-- Dynamically filled by JavaScript -->
            </div>

            <div class="result-card" id="recommendations-card" style="display: none;">
                <h2><i class='bx bx-bulb'></i> Recommendations</h2>
                <ul id="recommendations-list"></ul>
                <div class="info-note">
                    <strong>Note:</strong> This analysis focuses on technical readiness. AdSense approval also depends on content quality, traffic volume, and compliance with Google's policies.
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const analysisForm = document.getElementById('analysis-form');
        const urlInput = document.getElementById('url-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const resultsContainer = document.getElementById('results-container');
        const errorMessageDiv = document.getElementById('error-message');
        const scoreValue = document.getElementById('score-value');
        const scoreProgress = document.getElementById('score-progress');
        const scoreTitle = document.getElementById('score-title');
        const scoreSummary = document.getElementById('score-summary');
        const checklistCard = document.getElementById('checklist-card');
        const recommendationsCard = document.getElementById('recommendations-card');
        const recommendationsList = document.getElementById('recommendations-list');

        // Backend API URL - uses current domain for API calls
        const BACKEND_API_URL = `${window.location.origin}/api/analyze-url`; 
        const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * 84;

        /**
         * Sets the loading state of the analyze button.
         * @param {boolean} isLoading - True to show loading state, false otherwise.
         */
        const setButtonLoading = (isLoading) => {
            if (isLoading) {
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = `<span class="loader"></span><span>Analyzing...</span>`;
            } else {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = `<i class='bx bx-search-alt'></i><span>Analyze</span>`;
            }
        };

        /**
         * Displays an error message to the user.
         * @param {string} message - The error message to display.
         */
        const showError = (message) => {
            resultsContainer.style.display = 'none';
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
            recommendationsCard.style.display = 'none';
        };

        /** Hides any currently displayed error message. */
        const hideError = () => {
            errorMessageDiv.style.display = 'none';
        };

        /**
         * Updates the score circle and summary text based on the provided score.
         * @param {number} score - The technical readiness score (0-100).
         */
        const updateScoreUI = (score) => {
            const offset = CIRCLE_CIRCUMFERENCE - (score / 100) * CIRCLE_CIRCUMFERENCE;
            scoreProgress.style.strokeDasharray = CIRCLE_CIRCUMFERENCE;
            scoreProgress.style.strokeDashoffset = offset;

            let currentScore = 0;
            const interval = setInterval(() => {
                if(currentScore >= score) {
                    clearInterval(interval);
                    scoreValue.textContent = `${score}%`;
                } else {
                    currentScore++;
                    scoreValue.textContent = `${currentScore}%`;
                }
            }, 20);

            let summary, color;
            if (score >= 85) { summary = "Excellent technical foundation! Focus on content quality now."; color = 'var(--pass-color)'; }
            else if (score >= 60) { summary = "Good technical foundation, but key areas need attention."; color = 'var(--warn-color)'; }
            else { summary = "Critical technical issues detected. Address these before AdSense application."; color = 'var(--fail-color)'; }

            scoreTitle.textContent = "Technical Readiness Score";
            scoreSummary.textContent = summary;
            scoreProgress.style.stroke = color;
        };

        /**
         * Renders the checklist items dynamically based on the analysis results.
         * @param {Array<Object>} checks - An array of check results from the backend.
         */
        const renderChecklist = (checks) => {
            checklistCard.innerHTML = ''; // Clear previous results
            const categories = { 
                'Automated Technical Checks': [], 
                'Site Structure & Accessibility': [], 
                'Manual Checks for Content Quality': [] 
            };

            // Group checks by category
            checks.forEach(check => {
                if(categories[check.category]) {
                    categories[check.category].push(check);
                } else {
                    // Fallback for any new categories not explicitly listed
                    categories[check.category] = [check];
                }
            });

            for (const category in categories) {
                // Only render categories that have items or are explicitly defined as always present
                if (categories[category].length === 0 && !Object.keys(categories).includes(category)) {
                    continue; 
                }

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'checklist-category';
                let icon;
                switch(category) {
                    case 'Automated Technical Checks': icon = 'bx-cog'; break;
                    case 'Site Structure & Accessibility': icon = 'bx-sitemap'; break;
                    case 'Manual Checks for Content Quality': icon = 'bx-user-voice'; break;
                    default: icon = 'bx-info-circle'; // Default icon for any new categories
                }
                categoryDiv.innerHTML = `<h3><i class='bx ${icon}'></i> ${category}</h3>`;

                categories[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `check-item ${item.status}`;
                    let itemIcon;
                    switch(item.status) {
                        case 'pass': itemIcon = 'bxs-check-circle'; break;
                        case 'fail': itemIcon = 'bxs-x-circle'; break;
                        case 'warn': itemIcon = 'bxs-error-circle'; break;
                        case 'manual': itemIcon = 'bxs-info-circle'; break;
                        default: itemIcon = 'bxs-info-circle'; // Fallback
                    }
                    itemDiv.innerHTML = `<i class='bx ${itemIcon} icon'></i><div class="check-item-details"><strong>${item.name}</strong><p>${item.message}</p></div>`;
                    categoryDiv.appendChild(itemDiv);
                });
                checklistCard.appendChild(categoryDiv);
            }
            checklistCard.innerHTML += `<div class="final-disclaimer"><strong>Important:</strong> A high technical score does not guarantee AdSense approval. Your content's originality, value, and trustworthiness (E-E-A-T) are paramount. Pay close attention to the "Manual Checks" section.</div>`;
        };

        const displayRecommendations = (recommendations) => {
            recommendationsList.innerHTML = '';
            recommendations.forEach(recommendation => {
                const listItem = document.createElement('li');
                listItem.textContent = recommendation;
                recommendationsList.appendChild(listItem);
            });
            recommendationsCard.style.display = 'block';
        };

        /**
         * Analyzes the given URL by sending a request to the Node.js backend.
         * @param {string} initialUrl - The URL to analyze.
         */
        const analyzeWebsite = async (initialUrl) => {
            try {
                // Send the URL to your Node.js backend for analysis
                const response = await fetch(BACKEND_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: initialUrl }), // Send the URL in the request body
                });

                if (!response.ok) {
                    // If the backend returns an error status (e.g., 400, 500)
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Server error! Status: ${response.status}`);
                }

                const data = await response.json(); // Parse the JSON response from your backend

                hideError();
                resultsContainer.style.display = 'grid';
                document.getElementById('score-card').style.display = 'block'; 

                // Update UI with data received from the backend
                updateScoreUI(data.score); 
                renderChecklist(data.checks.sort((a, b) => {
                    // Sort categories for consistent display
                    const order = { 'Automated Technical Checks': 1, 'Site Structure & Accessibility': 2, 'Manual Checks for Content Quality': 3 };
                    return (order[a.category] || 99) - (order[b.category] || 99);
                }));

            } catch (error) {
                console.error("Analysis failed:", error);
                // Display user-friendly error message
                showError(`Analysis failed: ${error.message}. Please check the URL and try again. If the issue persists, your website might be blocking external access, or the server is too slow.`);
            }
        };

        const displayResults = (data) => {
            const { score, checks, finalResolvedUrl, analysisTime, recommendations } = data;

            document.getElementById('results-container').style.display = 'block';
            updateScoreUI(score);
            renderChecklist(checks);

            if (recommendations && recommendations.length > 0) {
                displayRecommendations(recommendations);
            } else {
                document.getElementById('recommendations-card').style.display = 'none';
            }

            if (finalResolvedUrl) {
                console.log('Final URL after redirects:', finalResolvedUrl);
            }

            if (analysisTime) {
                console.log(`Analysis completed in ${analysisTime}ms`);
            }
        };

        // Event listener for form submission
        analysisForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideError(); // Hide any previous error messages

            const rawUrl = urlInput.value.trim();
            if (!rawUrl) {
                showError("Please enter a website URL to analyze.");
                return;
            }

            let url;
            try {
                // Attempt to normalize the URL before sending to backend
                // The backend will handle further protocol attempts (http/https)
                url = new URL(rawUrl.startsWith('http://') || rawUrl.startsWith('https://') ? rawUrl : `https://${rawUrl}`).href;
            } catch (error) {
                showError("Please enter a valid URL (e.g., https://example.com or example.com).");
                return;
            }

            setButtonLoading(true); // Show loading state
            await analyzeWebsite(url); // Perform analysis using the backend
            setButtonLoading(false); // Hide loading state
        });
    });
    </script>
</body>
</html>